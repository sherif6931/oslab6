# This file was auto-generated.

name: Test Requirements

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main, dev ]

jobs:
  run-linux:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build ELF
      run: |
        mkdir -p bin
        gcc src/main.c -o bin/out

    - name: Check output (Linux)
      shell: bash
      run: |
        errors=""

        for input in 1 0; do
          echo "$input" > "in${input}.txt"
          timeout 15s ./bin/out < "in${input}.txt" > "out${input}.txt" || errors+="❎ Program Timeout"$'\n'

          output=$(cat "out${input}.txt")

          [[ "$output" =~ Child1\ PID:.*Parent\ PID: ]] || errors+="❎ Child1 PID/Parent Requirement Failed"$'\n'
          [[ "$output" =~ Child2\ PID:.*Parent\ PID: ]] || errors+="❎ Child2 PID/Parent Requirement Failed"$'\n'

          if [[ "$input" == "1" && "$output" =~ child\ process\ is\ resumed ]]; then
            errors+="❎ Child2 Should Have Been Killed"$'\n'
          fi

          if [[ "$input" == "0" && ! "$output" =~ child\ process\ is\ resumed ]]; then
            errors+="❎ Child2 Should Have Been Resumed"$'\n'
          fi
        done

        if [[ -n "$errors" ]]; then
          echo "$errors"
          exit 1
        fi
