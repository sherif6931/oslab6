# This file was auto-generated.

name: Test Requirements

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main, dev ]

jobs:
  run-linux:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build ELF
      run: |
        make

    - name: Check output
      shell: bash
      run: |
        errors=""
        
        ./bin/out <<EOF > out.txt 2>&1
        0
        1
        EOF

        output=$(cat out.txt)

        [[ "$output" =~ Child1\ PID:.*Parent\ PID: ]] || errors+="❎ Child1 PID/Parent Requirement Failed"$'\n'
        [[ "$output" =~ Child2\ PID:.*Parent\ PID: ]] || errors+="❎ Child2 PID/Parent Requirement Failed"$'\n'

        if [[ "$output" =~ "Child process resumed" ]]; then
            errors+="❎ Child2 Should Have Been Resumed"$'\n'
        fi

        [[ "$output" =~ "INTERRUPT=9" ]] || errors+="❎ Child2 should have been killed by SIGKILL (interrupt=9)"$'\n'

        if [[ -n "$errors" ]]; then
            echo "$errors"
            exit 1
        fi

        echo "✅ All checks passed"
